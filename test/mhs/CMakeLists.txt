project(stgc_test_mhs)

set(STGCC "${CMAKE_CURRENT_BINARY_DIR}/../../bin/stgc")
set(SRC_DIR ${CMAKE_SOURCE_DIR}/test/mhs)

file(GLOB ALL_SRCS *.mhs)

  foreach (test ${ALL_SRCS})
    get_filename_component(name ${test} NAME_WE)
    set(tname mhs_${name})
    if(name STREQUAL "eqintfalse")
       set(bname build_${tname})
       add_test(${bname} ${STGCC} -v ${SRC_DIR}/${name}.mhs -o ${tname})
       add_test(${tname} ${BINARY_DIR}/mhs/${tname} 2>&1)
       set_tests_properties(${tname} PROPERTIES DEPENDS ${bname})
       set_tests_properties(${tname} PROPERTIES PASS_REGULAR_EXPRESSION
       "The answer is[\r\n\t ]gfc_False = False")
       set(t2name ${tname}_nogc)
       add_test(${t2name} ${BINARY_DIR}/mhs/${tname} -g 2>&1)
       set_tests_properties(${t2name} PROPERTIES DEPENDS ${bname})
       set_tests_properties(${t2name} PROPERTIES PASS_REGULAR_EXPRESSION
       "The answer is[\r\n\t ]gfc_False = False")
       set(tnames ${tname}_strict)
       set(bnames build_${tnames})
       add_test(${bnames} ${STGCC} -v -s ${SRC_DIR}/${name}.mhs -o ${tnames})
       add_test(${tnames} ${BINARY_DIR}/mhs/${tnames} 2>&1)
       set_tests_properties(${tnames} PROPERTIES DEPENDS ${bnames})
       set_tests_properties(${tnames} PROPERTIES PASS_REGULAR_EXPRESSION
       "The answer is[\r\n\t ]gfc_False = False")
       set(t2names ${tnames}_nogc)
       add_test(${t2names} ${BINARY_DIR}/mhs/${tnames} -g 2>&1)
       set_tests_properties(${t2names} PROPERTIES DEPENDS ${bnames})
       set_tests_properties(${t2names} PROPERTIES PASS_REGULAR_EXPRESSION
       "The answer is[\r\n\t ]gfc_False = False")
    else()
       set(bname build_${tname})
       add_test(${bname} ${STGCC} -v ${SRC_DIR}/${name}.mhs -o ${tname})
       add_test(${tname} ${BINARY_DIR}/mhs/${tname} 2>&1)
       set_tests_properties(${tname} PROPERTIES DEPENDS ${bname})
       set_tests_properties(${tname} PROPERTIES PASS_REGULAR_EXPRESSION
       "The answer is[\r\n\t ]gfc_True = True")
       set(t2name ${tname}_nogc)
       add_test(${t2name} ${BINARY_DIR}/mhs/${tname} -g 2>&1)
       set_tests_properties(${t2name} PROPERTIES DEPENDS ${bname})
       set_tests_properties(${t2name} PROPERTIES PASS_REGULAR_EXPRESSION
       "The answer is[\r\n\t ]gfc_True = True")
       set(tnames ${tname}_strict)
       set(bnames build_${tnames})
       add_test(${bnames} ${STGCC} -v -s ${SRC_DIR}/${name}.mhs -o ${tnames})
       add_test(${tnames} ${BINARY_DIR}/mhs/${tnames} 2>&1)
       set_tests_properties(${tnames} PROPERTIES DEPENDS ${bnames})
       set_tests_properties(${tnames} PROPERTIES PASS_REGULAR_EXPRESSION
       "The answer is[\r\n\t ]gfc_True = True")
       set(t2names ${tnames}_nogc)
       add_test(${t2names} ${BINARY_DIR}/mhs/${tnames} -g 2>&1)
       set_tests_properties(${t2names} PROPERTIES DEPENDS ${bnames})
       set_tests_properties(${t2names} PROPERTIES PASS_REGULAR_EXPRESSION
       "The answer is[\r\n\t ]gfc_True = True")
    endif()
  endforeach(test)
