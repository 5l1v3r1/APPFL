#!/bin/bash
#
# very simple wrapper to compile stg
# run make at top level to build stgc binary

DIR=$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )
STGC=$DIR/../codegen/dist/build/stgc/stgc 
RUNTIMEDIR=$DIR/../runtime
FLAGS="-std=gnu99 -L$RUNTIMEDIR -I$RUNTIMEDIR -lruntime"

if [ "$#" -eq 0 ]; then
  echo "usage: $0 infile [outfile]"
  exit 1
fi

if [ "${2::1}" == "-" ]; then
  $STGC $1 $2
  exit 0;
fi

$STGC $1 /tmp/$1.$$.c

if [ "$#" -eq 1 ]; then
  gcc /tmp/$1.$$.c $FLAGS
else
  gcc /tmp/$1.$$.c -o $2 $FLAGS

fi
